{% extends 'base.html' %}
{% block title %}Kontakt - IT-Praktika{% endblock %}

{% block content %}
<div class="px-4 px-md-5 py-5">
    <h2 class="mb-4">Kontakt</h2>
    <div class="row">
        <!-- Kontaktinfos + Map -->
        <div class="col-md-6 mb-4">
            <ul class="list-group list-group-flush mb-3">
                <li class="list-group-item"><strong>Adresse:</strong> Inseliquai 12B, 6005 Luzern</li>
                <li class="list-group-item"><strong>Telefon:</strong> 041 227 01 01</li>
                <li class="list-group-item"><strong>Fax:</strong> 041 227 01 02</li>
                <li class="list-group-item"><strong>E-Mail:</strong> <a href="mailto:info@it-praktika.ch">info@it-praktika.ch</a></li>
            </ul>
            <!-- Google Maps -->
            <div class="rounded shadow-sm overflow-hidden mb-3" style="height: 250px;">
                <iframe
                    src="https://www.google.com/maps?q=Inseliquai+12B,+6005+Luzern,+Schweiz&output=embed"
                    width="100%" height="250" style="border:0;" allowfullscreen="" loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
        </div>
        <!-- Kontaktformular -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="card-title mb-3">Kontaktformular</h5>
                    <!-- WICHTIG: Die Form erhält eine ID und action="#" -->
                    <form id="contactForm" action="#" method="post">
                        <div class="mb-3">
                            <label for="name" class="form-label">Name*</label>
                            <input type="text" class="form-control" id="name" name="name" placeholder="Ihr Name" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">E-Mail*</label>
                            <input type="email" class="form-control" id="email" name="email" placeholder="name@example.com" required>
                        </div>
                        <div class="mb-3">
                            <label for="message" class="form-label">Nachricht*</label>
                            <textarea class="form-control" id="message" name="message" rows="4" placeholder="Ihre Nachricht ..." required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary w-100" id="submitBtn">Senden</button>
                        <div id="statusMessage" class="mt-3"></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ================= JavaScript für asynchronen E-Mail-Versand ================= -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('contactForm');
    const submitBtn = document.getElementById('submitBtn');
    const statusMessage = document.getElementById('statusMessage');

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      submitBtn.disabled = true;
      statusMessage.textContent = 'Sende Nachricht...';

      // FormData sammeln
      const formData = new FormData(form);
      const payload = {
        name: formData.get('name'),
        email: formData.get('email'),
        message: formData.get('message')
      };

      // Per fetch an Flask-Endpoint schicken
      fetch("{{ url_for('main.send_email') }}", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          statusMessage.innerHTML = '<div class="alert alert-success">Ihre Nachricht wurde erfolgreich gesendet.</div>';
          form.reset();
        } else {
          statusMessage.innerHTML = '<div class="alert alert-danger">Fehler: ' + data.error + '</div>';
        }
      })
      .catch(err => {
        console.error(err);
        statusMessage.innerHTML = '<div class="alert alert-danger">Beim Senden ist ein Fehler aufgetreten.</div>';
      })
      .finally(() => {
        submitBtn.disabled = false;
      });
    });
  });
</script>
{% endblock %}
